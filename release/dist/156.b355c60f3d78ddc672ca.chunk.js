webpackJsonp([156],{1083:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],staticClass:"x-ivu-modal",attrs:{"mask-closable":!1,title:t.modal$.title,width:"850"},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[o("Form",{ref:"form",staticClass:"x-ivu-form row",attrs:{"label-width":100,model:t.info,rules:t.rules}},[o("Form-item",{staticClass:"col-sm-4",attrs:{label:"姓名",prop:"student_name"}},[o("Input",{attrs:{placeholder:"请输入学员姓名"},model:{value:t.info.student_name,callback:function(e){t.$set(t.info,"student_name",e)},expression:"info.student_name"}})],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"出生日期",prop:"birth_time"}},[o("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",value:t.info.birth_time,format:"yyyy-MM-dd",placeholder:"选择日期"},on:{"on-change":function(e){t.info.birth_time=e}}})],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"卡号",prop:"card_no"}},[o("Input",{attrs:{placeholder:"请输入考勤卡号"},model:{value:t.info.card_no,callback:function(e){t.$set(t.info,"card_no",e)},expression:"info.card_no"}})],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"首选手机号",prop:"first_tel"}},[o("Input",{attrs:{readonly:t.readonly1,placeholder:"请输入手机号码"},on:{"on-blur":function(e){t.get_students("first_tel")}},model:{value:t.info.first_tel,callback:function(e){t.$set(t.info,"first_tel",e)},expression:"info.first_tel"}})],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"关系",prop:"first_family_rel"}},[o("Select",{model:{value:t.info.first_family_rel,callback:function(e){t.$set(t.info,"first_family_rel",e)},expression:"info.first_family_rel"}},t._l(t.rel_list,function(e,s){return o("Option",{key:s,attrs:{value:e.value}},[t._v(t._s(e.text))])}))],1),t._v(" "),1!=t.info.first_family_rel?o("Form-item",{staticClass:"col-sm-4",attrs:{label:"亲属姓名",prop:"first_family_name"}},[o("Input",{attrs:{placeholder:"请输入亲属姓名"},model:{value:t.info.first_family_name,callback:function(e){t.$set(t.info,"first_family_name",e)},expression:"info.first_family_name"}})],1):t._e(),t._v(" "),1==t.info.first_family_rel?o("div",{staticClass:"col-sm-4"}):t._e(),t._v(" "),o("p",{staticClass:"text-center col-sm-12 mb-3"},[o("a",{staticClass:"text-info",on:{click:function(e){t.show_all=!t.show_all}}},[t._v("\n\t\t\t\t"+t._s(t.show_all?"收起":"展开更多")+"\n\t\t\t\t"),o("Icon",{attrs:{type:t.show_all?"chevron-up":"chevron-down"}})],1)]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.show_all,expression:"show_all"}],staticClass:"row m-0"},[o("Form-item",{staticClass:"col-sm-4",attrs:{label:"昵称",prop:"nick_name"}},[o("Input",{attrs:{placeholder:"请输入昵称"},model:{value:t.info.nick_name,callback:function(e){t.$set(t.info,"nick_name",e)},expression:"info.nick_name"}})],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"性别",prop:"sex"}},[o("Radio-group",{attrs:{type:"button"},model:{value:t.info.sex,callback:function(e){t.$set(t.info,"sex",e)},expression:"info.sex"}},[o("Radio",{attrs:{label:"1"}},[t._v("男")]),t._v(" "),o("Radio",{attrs:{label:"2"}},[t._v("女")])],1)],1),t._v(" "),o("div",{staticClass:"col-sm-4"}),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"第二电话",prop:"second_tel"}},[o("Input",{attrs:{placeholder:"请输入手机号码",readonly:t.readonly2},model:{value:t.info.second_tel,callback:function(e){t.$set(t.info,"second_tel",e)},expression:"info.second_tel"}})],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"关系",prop:"second_family_rel"}},[o("Select",{model:{value:t.info.second_family_rel,callback:function(e){t.$set(t.info,"second_family_rel",e)},expression:"info.second_family_rel"}},t._l(t.rel_list,function(e,s){return o("Option",{key:s,attrs:{value:e.value}},[t._v(t._s(e.text))])}))],1),t._v(" "),1==t.info.second_family_rel?o("div",{staticClass:"col-sm-4"}):t._e(),t._v(" "),1!=t.info.second_family_rel?o("Form-item",{staticClass:"col-sm-4",attrs:{label:"亲属姓名",prop:"second_family_name"}},[o("Input",{attrs:{placeholder:"请输入亲属姓名"},model:{value:t.info.second_family_name,callback:function(e){t.$set(t.info,"second_family_name",e)},expression:"info.second_family_name"}})],1):t._e(),t._v(" "),o("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"公立学校",prop:"school_id"}},[t.info.school_id_text&&t.editSchool?[o("span",[t._v(t._s(t.info.school_id_text))]),t._v(" "),o("Button",{attrs:{size:"small",shape:"circle",icon:"edit"},on:{click:function(e){t.editSchool=!t.editSchool}}})]:[o("select-school",{ref:"ref_select_school",on:{"on-select":t.searchSelect,"on-clear":t.clearSelect}}),t._v(" "),o("Button",{directives:[{name:"show",rawName:"v-show",value:t.info.school_id_text,expression:"info.school_id_text"}],attrs:{size:"small",shape:"circle",icon:"reply"},on:{click:t.undoEdit}})]],2),t._v(" "),o("Form-item",{staticClass:"col-sm-4",attrs:{label:"年级",prop:"school_grade"}},[o("Select",{model:{value:t.info.school_grade,callback:function(e){t.$set(t.info,"school_grade",e)},expression:"info.school_grade"}},[o("Option",{attrs:{value:0}},[t._v("请选择")]),t._v(" "),t._l(t.dicts("grade"),function(e,s){return o("Option",{key:s,attrs:{value:e.name}},[t._v(t._s(e.title))])})],2)],1),t._v(" "),o("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"班级",prop:"school_class"}},[o("Input",{attrs:{placeholder:"请输入班级名称"},model:{value:t.info.school_class,callback:function(e){t.$set(t.info,"school_class",e)},expression:"info.school_class"}})],1),t._v(" "),t._l(t.option_form_items,function(e){return["text"==e.type?o("Form-item",{staticClass:"col-sm-4",attrs:{label:e.label}},[o("Input",{attrs:{placeholder:"请输入"+e.label},model:{value:e.value,callback:function(o){t.$set(e,"value",o)},expression:"item.value"}})],1):t._e(),t._v(" "),"date"==e.type?o("Form-item",{staticClass:"col-sm-4",attrs:{label:e.label}},[o("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",value:e.value,format:"yyyy-MM-dd",placeholder:"选择日期"},on:{"on-change":function(t){e.value=t}}})],1):t._e(),t._v(" "),"number"==e.type?o("Form-item",{staticClass:"col-sm-4",attrs:{label:e.label}},[o("InputNumber",{model:{value:e.value,callback:function(o){t.$set(e,"value",o)},expression:"item.value"}})],1):t._e(),t._v(" "),"textarea"==e.type?o("Form-item",{staticClass:"col-sm-12",attrs:{label:e.label}},[o("Input",{attrs:{type:"textarea",placeholder:"请输入"+e.label},model:{value:e.value,callback:function(o){t.$set(e,"value",o)},expression:"item.value"}})],1):t._e()]})],2)],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"ghost"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),o("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)],1)},a=[];s._withStripped=!0;var i={render:s,staticRenderFns:a};e.a=i},354:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(986),a=o(1083),i=o(11),l=i(s.a,a.a,!1,null,null,null);l.options.__file="src/views/business/student/info-modal.vue",e.default=l.exports},602:function(t,e,o){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=o(611),i=s(a),l=o(212),n=s(l);e.default=function(){function t(t,e){var o=[],s=!0,a=!1,i=void 0;try{for(var l,r=(0,n.default)(t);!(s=(l=r.next()).done)&&(o.push(l.value),!e||o.length!==e);s=!0);}catch(t){a=!0,i=t}finally{try{!s&&r.return&&r.return()}finally{if(a)throw i}}return o}return function(e,o){if(Array.isArray(e))return e;if((0,i.default)(Object(e)))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},611:function(t,e,o){t.exports={default:o(612),__esModule:!0}},612:function(t,e,o){o(36),o(27),t.exports=o(613)},613:function(t,e,o){var s=o(56),a=o(4)("iterator"),i=o(18);t.exports=o(2).isIterable=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||i.hasOwnProperty(s(e))}},732:function(t,e,o){"use strict";var s=o(863);e.a={components:{infoModal:s.a},props:{},data:function(){return{school_name:""}},methods:{addInfo:function(){this.$refs.info.show("添加公立学校","add")},searchSelect:function(t){this.$emit("on-select",t)},resetSchoolName:function(){this.school_name=""}},computed:{public_schools:function(){var t=this.school_name,e=this.$store.state.gvars.public_schools;return/$\s*^/.test(t)?e:e.filter(function(e){return e.school_name.indexOf(t)>-1})}},watch:{school_name:function(t){""===t&&this.$emit("on-clear")}}}},733:function(t,e,o){"use strict";var s=o(602),a=o.n(s),i=o(1),l=o(209),n=o(211),r=o(210),c={province_id:0,city_id:0,district_id:0,area_id:0,areas_arr:[],school_name:""};e.a={mixins:[l.a,n.a,r.a],data:function(){return{info:i.b.copy(c),rules:{school_name:[{required:!0,message:"请输入校区名称",trigger:"blur"}],areas_arr:[{required:!0,type:"array",message:"请选择校区位置",trigger:"change"}]}}},methods:{cancel:function(){this.$form("form").reset(),this.info=i.b.copy(c),this.close()},ok:function(){var t=this;this.$form("form").check().then(function(){var e=t.modal$.action,o="add"==e?["post","public_schools","添加成功"]:["put","public_schools/"+t.info.ps_id,"编辑成功"],s=a()(o,3),i=s[0],l=s[1],n=s[2];t.$rest(l)[i](t.info).success(function(e){t.$store.dispatch("updateGlobalVar","public_schools"),t.$Message.success(n),t.$emit("on-success"),t.cancel()}).error(function(e){t.$Notice.error({title:"失败",desc:e.message||"添加失败"})})})}},computed:{branch_area:{get:function(){var t=[this.info.province_id,this.info.city_id,this.info.district_id];return this.info.areas_arr||t},set:function(t){this.info.province_id=t[0],this.info.city_id=t[1],this.info.district_id=t[2],this.info.area_id=t[2],this.info.areas_arr=t}}}}},863:function(t,e,o){"use strict";function s(t){l||o(867)}var a=o(733),i=o(868),l=!1,n=o(11),r=s,c=n(a.a,i.a,!1,r,null,null);c.options.__file="src/views/basic/school/info-modal.vue",e.a=c.exports},865:function(t,e,o){"use strict";function s(t){l||o(866)}var a=o(732),i=o(869),l=!1,n=o(11),r=s,c=n(a.a,i.a,!1,r,null,null);c.options.__file="src/views/basic/school/select-school.vue",e.a=c.exports},866:function(t,e){},867:function(t,e){},868:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{attrs:{title:t.modal$.title,"mask-closable":!1,width:"680"},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[t.modal$.show?o("div",[o("Form",{ref:"form",attrs:{"label-width":80,model:t.info,rules:t.rules}},[o("Form-item",{attrs:{label:"学校名称",prop:"school_name"}},[o("Input",{attrs:{placeholder:"请输入校区名称"},model:{value:t.info.school_name,callback:function(e){t.$set(t.info,"school_name",e)},expression:"info.school_name"}})],1),t._v(" "),o("Form-item",{attrs:{label:"学校位置",prop:"areas_arr"}},[o("Cascader",{attrs:{trigger:"hover",data:t.areas},model:{value:t.branch_area,callback:function(e){t.branch_area=e},expression:"branch_area"}})],1),t._v(" "),o("Form-item",{attrs:{label:"详细地址",prop:"address"}},[o("Input",{attrs:{placeholder:"请输入详细地址"},model:{value:t.info.address,callback:function(e){t.$set(t.info,"address",e)},expression:"info.address"}})],1)],1)],1):t._e(),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"ghost"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),o("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.ok}},[t._v("确定")])],1)])},a=[];s._withStripped=!0;var i={render:s,staticRenderFns:a};e.a=i},869:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"x-select-school"},[o("AutoComplete",{attrs:{clearable:"",placeholder:"请输入校区名称"},model:{value:t.school_name,callback:function(e){t.school_name=e},expression:"school_name"}},t._l(t.public_schools,function(e){return o("Option",{key:e.ps_id,attrs:{value:e.school_name},nativeOn:{click:function(o){t.searchSelect(e)}}},[o("span",{staticClass:"demo-auto-complete-title"},[t._v(t._s(e.school_name))])])})),t._v(" "),o("info-modal",{ref:"info"}),t._v(" "),o("Button",{directives:[{name:"per",rawName:"v-per",value:"schools.add",expression:"'schools.add'"}],attrs:{slot:"append",icon:"plus",title:"添加公立学校"},on:{click:t.addInfo},slot:"append"})],1)},a=[];s._withStripped=!0;var i={render:s,staticRenderFns:a};e.a=i},986:function(t,e,o){"use strict";var s=o(1),a=o(211),i=o(209),l=o(865),n={sid:0,sex:"1",bid:0,student_name:"",nick_name:"",birth_time:"",school_id_text:"",school_id:0,school_grade:0,school_class:"",first_tel:"",first_family_rel:"",first_family_name:"",second_tel:"",second_family_rel:"",second_family_name:"",card_no:""};e.a={mixins:[i.a,a.a],components:{SelectSchool:l.a},data:function(){return{schools:[],show_all:!1,readonly1:!1,readonly2:!1,editSchool:!1,ps_id_cach:0,rel_list:[{value:1,text:"自己"},{value:2,text:"爸爸"},{value:3,text:"妈妈"},{value:4,text:"其他"}],info:s.b.copy(n),rules:{student_name:[{required:!0,message:"姓名不能为空",trigger:"blur"}],first_tel:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机格式错误",trigger:"blur"}]},option_form_items:[]}},watch:{"modal$.show":function(t){t&&(this.readonly1=this.info.first_tel.length>0,this.readonly2=this.info.second_tel.length>0,this.editSchool=!0,this.show_all=!1,"add"==this.modal$.action?this.info=s.b.copy(n):this.ps_id_cach=this.info.school_id,this.buildOptionFormItems())}},methods:{buildOptionFormItems:function(){this.option_form_items=[];for(var t=this.$store.state.gvars.configs.student_option_fields,e=this.info.option_fields||{},o=0;o<t.length;o++){var s=t[o];1==s.enable&&this.option_form_items.push({label:s.label,type:s.type,field:s.name,value:e[s.name]||function(t){return"number"==t?0:"date"==t?new Date:""}(s.type)})}},getOptionFieldsValue:function(){var t={};return this.option_form_items.forEach(function(e){t[e.field]=e.value}),t},cancel:function(){var t=this.$r("ref_select_school");this.$form("form").reset(),this.close(),void 0!=t&&t.resetSchoolName()},ok:function(){var t=this,e="post",o="students",s="添加成功";"edit"==this.modal$.action&&(e="put",o="students/"+this.info.sid,s="修改成功"),this.info.bid=this.bid$,this.info.option_fields=this.getOptionFieldsValue(),this.$form("form").check().then(function(a){t.$rest(o)[e](t.info).success(function(e){t.$Message.success(s),t.$emit("on-save-success"),t.cancel()}).error(function(e){t.$Message.error(e.body.message||"添加失败")})})},get_students:function(){},searchSelect:function(t){this.info.school_id=t.ps_id},clearSelect:function(){"add"==this.modal$.action?this.info.school_id=0:this.info.school_id=this.ps_id_cach},handleSearch:function(t){var e=this;this.$rest("public_schools?name="+t).get().success(function(t){e.schools=t.list}).error(function(t){e.$Message.error(t.body.message||"搜索失败！")})},undoEdit:function(){this.editSchool=!this.editSchool,this.info.school_id=this.ps_id_cach}}}}});